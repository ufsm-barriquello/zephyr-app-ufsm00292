üóìÔ∏è Semana 5: Otimiza√ß√£o de Consumo de Energia (Power Management)
Foco: O build inicial funciona, mas o host (SAMD21) nunca entra em modo de baixo consumo. Ele permanece no loop de idle (k_cpu_idle), drenando energia. Esta semana foi dedicada a habilitar o Power Management (PM) do Zephyr.

2.1. Diagn√≥stico do Problema
Medi√ß√µes de corrente (n√£o realizadas, mas presumidas) mostrariam um consumo muito alto para uma aplica√ß√£o BLE, pois o Cortex-M0+ (SAMD21) est√° sempre ativo, mesmo quando n√£o h√° tr√°fego BLE.

2.2. Solu√ß√£o: Zephyr Power Management & Device PM
A SAMD21 suporta m√∫ltiplos estados de sono (Sleep States). O Zephyr pode gerenciar isso automaticamente.

Modifica√ß√µes no prj.conf:

Snippet de c√≥digo

# --- CONFIGS DE POWER MANAGEMENT (Semana 2) ---

# Habilita o framework de Power Management global
CONFIG_PM=y

# Habilita o gerenciamento de energia em n√≠vel de dispositivo (ex: UART, SPI)
CONFIG_PM_DEVICE=y

# Permite que a pol√≠tica de PM do Zephyr coloque o sistema em sleep
CONFIG_PM_SYSTEM_SLEEP=y
2.3. O Desafio: Perif√©ricos Ativos (HCI UART)
O maior "pega-rat√£o" √© este: o sistema n√£o pode dormir se um perif√©rico estiver ativo. No nosso caso, o SERCOM4 (HCI UART) est√° sempre ativo, esperando dados do BTLC1000.

Pesquisa: O driver atmel,sam0-uart precisa suportar a API de device_pm_control. Quando o Zephyr decide dormir, ele primeiro pergunta a todos os drivers se eles podem entrar em modo de baixo consumo.

Problema: O SERCOM4 (UART) n√£o pode dormir, pois √© a nossa linha de vida para o r√°dio BLE.

Solu√ß√£o (Parcial): O BTLC1000 (controlador) gerencia seu pr√≥prio sleep. O host (SAMD21) pode dormir desde que o BTLC1000 possa acord√°-lo.

Implementa√ß√£o Futura (Necess√°ria): Seria preciso usar a linha RTS/CTS (flow control) n√£o apenas para dados, mas como um sinal de wake-up. O BTLC1000 (via sua linha RTS, conectada ao CTS do SAMD21) precisaria acordar o SAMD21 (via interrup√ß√£o de pino) antes de enviar dados HCI.

Corre√ß√£o Imediata (Simples): Habilitar CONFIG_UART_SAM0_PM_ENABLE (se dispon√≠vel no driver) para permitir que o driver UART participe do gerenciamento de energia.

Resultado: Habilitar CONFIG_PM √© o primeiro passo. A otimiza√ß√£o real requer uma integra√ß√£o mais profunda entre o estado de sono do BTLC1000 e a capacidade de wake-up do SAMD21, provavelmente usando uma interrup√ß√£o de GPIO (no pino CTS) para acordar o host.
